<div class="bb-menu-container">
    <div class="container-fluid">
        <div class="row">
            <div class="col-md-12">
                <div class="panel panel-default">
                    <div class="panel-heading menu-panel">
                        <h3 class="panel-title pull-left">
                            <label>Menu Name</label>
                            <input type="text" class="menu-name-field" value="Main Menu">
                        </h3>

                        <div class="pull-right">
                            <a href="javascript:" class="btn btn-primary btn-sm bb-menu-save">Save</a>
                            <a href="javascript:" class="btn btn-success btn-sm">Preview</a>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <div class="row">
            <div class="col-md-4">
                <ol class="bb-sortable-static bb-sortable-group">
                    <li data-id="frontend-pages" id="menu-item-front">
                        <div class="panel panel-default">
                            <div class="bb-menu-item-title">
                                <i></i>
                                <strong>Frontend Pages</strong>

                                <div class="bb-menu-actions pull-right">
                                    <a href="javascript:" class="bb-menu-delete">
                                        <i class="fa fa-close"></i>
                                    </a>
                                    <a href="javascript:" class="bb-menu-collapse expand">
                                        <i class="fa fa-caret-up"></i>
                                    </a>
                                </div>
                            </div>
                            <div class="panel-body bb-menu-group-body">

                                <ol class="bb-sortable-static">
                                    <li data-id="1" id="menu-item-1">
                                        <div class="bb-menu-item">
                                            <div class="bb-menu-item-title">
                                                <i></i>
                                                <span>Home</span>

                                                <div class="bb-menu-actions pull-right">
                                                    <a href="javascript:" class="bb-menu-delete">
                                                        <i class="fa fa-close"></i>
                                                    </a>
                                                    <a href="javascript:" class="bb-menu-collapse">
                                                        <i class="fa fa-caret-down"></i>
                                                    </a>
                                                </div>
                                            </div>
                                            <div class="bb-menu-item-body">
                                                <div class="bb-menu-form">
                                                    <div class="row">
                                                        <div class="col-md-4">
                                                            <div class="form-group">
                                                                <label>Icon</label>
                                                                <input type="text" data-placement="right"
                                                                       class="form-control input-sm icp-auto">
                                                            </div>
                                                        </div>
                                                        <div class="col-md-8">
                                                            <div class="form-group">
                                                                <label>Item Title</label>
                                                                <input type="text"
                                                                       class="form-control input-sm menu-item-title">
                                                            </div>
                                                        </div>
                                                    </div>

                                                    <div class="form-group">
                                                        <label>Item URL</label>
                                                        <input type="text" class="form-control input-sm">
                                                    </div>
                                                </div>
                                            </div>
                                        </div>
                                    </li>
                                    <li data-id="2" id="menu-item-2">
                                        <div class="bb-menu-item">
                                            <div class="bb-menu-item-title">
                                                <i></i>
                                                <span>About</span>

                                                <div class="bb-menu-actions pull-right">
                                                    <a href="javascript:" class="bb-menu-delete">
                                                        <i class="fa fa-close"></i>
                                                    </a>
                                                    <a href="javascript:" class="bb-menu-collapse">
                                                        <i class="fa fa-caret-down"></i>
                                                    </a>
                                                </div>
                                            </div>
                                            <div class="bb-menu-item-body">
                                                <div class="bb-menu-form">
                                                    <div class="row">
                                                        <div class="col-md-4">
                                                            <div class="form-group">
                                                                <label>Icon</label>
                                                                <input type="text" data-placement="right"
                                                                       class="form-control input-sm icp-auto">
                                                            </div>
                                                        </div>
                                                        <div class="col-md-8">
                                                            <div class="form-group">
                                                                <label>Item Title</label>
                                                                <input type="text"
                                                                       class="form-control input-sm menu-item-title">
                                                            </div>
                                                        </div>
                                                    </div>

                                                    <div class="form-group">
                                                        <label>Item URL</label>
                                                        <input type="text" class="form-control input-sm">
                                                    </div>
                                                </div>
                                            </div>
                                        </div>
                                    </li>
                                    <li data-id="3" id="menu-item-3">
                                        <div class="bb-menu-item">
                                            <div class="bb-menu-item-title">
                                                <i></i>
                                                <span>Contact</span>

                                                <div class="bb-menu-actions pull-right">
                                                    <a href="javascript:" class="bb-menu-delete">
                                                        <i class="fa fa-close"></i>
                                                    </a>
                                                    <a href="javascript:" class="bb-menu-collapse">
                                                        <i class="fa fa-caret-down"></i>
                                                    </a>
                                                </div>
                                            </div>
                                            <div class="bb-menu-item-body">
                                                <div class="bb-menu-form">
                                                    <div class="row">
                                                        <div class="col-md-4">
                                                            <div class="form-group">
                                                                <label>Icon</label>
                                                                <input type="text" data-placement="right"
                                                                       class="form-control input-sm icp-auto">
                                                            </div>
                                                        </div>
                                                        <div class="col-md-8">
                                                            <div class="form-group">
                                                                <label>Item Title</label>
                                                                <input type="text"
                                                                       class="form-control input-sm menu-item-title">
                                                            </div>
                                                        </div>
                                                    </div>

                                                    <div class="form-group">
                                                        <label>Item URL</label>
                                                        <input type="text" class="form-control input-sm">
                                                    </div>
                                                </div>
                                            </div>
                                        </div>
                                    </li>
                                    <li data-id="4" id="menu-item-4">
                                        <div class="bb-menu-item">
                                            <div class="bb-menu-item-title">
                                                <i></i>
                                                <span>Privacy</span>

                                                <div class="bb-menu-actions pull-right">
                                                    <a href="javascript:" class="bb-menu-delete">
                                                        <i class="fa fa-close"></i>
                                                    </a>
                                                    <a href="javascript:" class="bb-menu-collapse">
                                                        <i class="fa fa-caret-down"></i>
                                                    </a>
                                                </div>
                                            </div>
                                            <div class="bb-menu-item-body">
                                                <div class="bb-menu-form">
                                                    <div class="row">
                                                        <div class="col-md-4">
                                                            <div class="form-group">
                                                                <label>Icon</label>
                                                                <input type="text" data-placement="right"
                                                                       class="form-control input-sm icp-auto">
                                                            </div>
                                                        </div>
                                                        <div class="col-md-8">
                                                            <div class="form-group">
                                                                <label>Item Title</label>
                                                                <input type="text"
                                                                       class="form-control input-sm menu-item-title">
                                                            </div>
                                                        </div>
                                                    </div>

                                                    <div class="form-group">
                                                        <label>Item URL</label>
                                                        <input type="text" class="form-control input-sm">
                                                    </div>
                                                </div>
                                            </div>
                                        </div>
                                    </li>
                                </ol>

                            </div>
                        </div>
                    </li>
                    <li data-id="custom-pages" id="menu-item-custom">
                        <div class="panel panel-default">
                            <div class="bb-menu-item-title">
                                <i></i>
                                <strong>Custom Pages</strong>

                                <div class="bb-menu-actions pull-right">
                                    <a href="javascript:" class="bb-menu-delete">
                                        <i class="fa fa-close"></i>
                                    </a>
                                    <a href="javascript:" class="bb-menu-collapse expand">
                                        <i class="fa fa-caret-up"></i>
                                    </a>
                                </div>
                            </div>
                            <div class="panel-body bb-menu-group-body">

                                <ol class="bb-sortable-static">
                                    <li data-id="1" id="menu-item-1">
                                        <div class="bb-menu-item">
                                            <div class="bb-menu-item-title">
                                                <i></i>
                                                <span>Home</span>

                                                <div class="bb-menu-actions pull-right">
                                                    <a href="javascript:" class="bb-menu-delete">
                                                        <i class="fa fa-close"></i>
                                                    </a>
                                                    <a href="javascript:" class="bb-menu-collapse">
                                                        <i class="fa fa-caret-down"></i>
                                                    </a>
                                                </div>
                                            </div>
                                            <div class="bb-menu-item-body">
                                                <div class="bb-menu-form">
                                                    <div class="row">
                                                        <div class="col-md-4">
                                                            <div class="form-group">
                                                                <label>Icon</label>
                                                                <input type="text" data-placement="right"
                                                                       class="form-control input-sm icp-auto">
                                                            </div>
                                                        </div>
                                                        <div class="col-md-8">
                                                            <div class="form-group">
                                                                <label>Item Title</label>
                                                                <input type="text"
                                                                       class="form-control input-sm menu-item-title">
                                                            </div>
                                                        </div>
                                                    </div>

                                                    <div class="form-group">
                                                        <label>Item URL</label>
                                                        <input type="text" class="form-control input-sm">
                                                    </div>
                                                </div>
                                            </div>
                                        </div>
                                    </li>
                                    <li data-id="2" id="menu-item-2">
                                        <div class="bb-menu-item">
                                            <div class="bb-menu-item-title">
                                                <i></i>
                                                <span>About</span>

                                                <div class="bb-menu-actions pull-right">
                                                    <a href="javascript:" class="bb-menu-delete">
                                                        <i class="fa fa-close"></i>
                                                    </a>
                                                    <a href="javascript:" class="bb-menu-collapse">
                                                        <i class="fa fa-caret-down"></i>
                                                    </a>
                                                </div>
                                            </div>
                                            <div class="bb-menu-item-body">
                                                <div class="bb-menu-form">
                                                    <div class="row">
                                                        <div class="col-md-4">
                                                            <div class="form-group">
                                                                <label>Icon</label>
                                                                <input type="text" data-placement="right"
                                                                       class="form-control input-sm icp-auto">
                                                            </div>
                                                        </div>
                                                        <div class="col-md-8">
                                                            <div class="form-group">
                                                                <label>Item Title</label>
                                                                <input type="text"
                                                                       class="form-control input-sm menu-item-title">
                                                            </div>
                                                        </div>
                                                    </div>

                                                    <div class="form-group">
                                                        <label>Item URL</label>
                                                        <input type="text" class="form-control input-sm">
                                                    </div>
                                                </div>
                                            </div>
                                        </div>
                                    </li>
                                    <li data-id="3" id="menu-item-3">
                                        <div class="bb-menu-item">
                                            <div class="bb-menu-item-title">
                                                <i></i>
                                                <span>Contact</span>

                                                <div class="bb-menu-actions pull-right">
                                                    <a href="javascript:" class="bb-menu-delete">
                                                        <i class="fa fa-close"></i>
                                                    </a>
                                                    <a href="javascript:" class="bb-menu-collapse">
                                                        <i class="fa fa-caret-down"></i>
                                                    </a>
                                                </div>
                                            </div>
                                            <div class="bb-menu-item-body">
                                                <div class="bb-menu-form">
                                                    <div class="row">
                                                        <div class="col-md-4">
                                                            <div class="form-group">
                                                                <label>Icon</label>
                                                                <input type="text" data-placement="right"
                                                                       class="form-control input-sm icp-auto">
                                                            </div>
                                                        </div>
                                                        <div class="col-md-8">
                                                            <div class="form-group">
                                                                <label>Item Title</label>
                                                                <input type="text"
                                                                       class="form-control input-sm menu-item-title">
                                                            </div>
                                                        </div>
                                                    </div>

                                                    <div class="form-group">
                                                        <label>Item URL</label>
                                                        <input type="text" class="form-control input-sm">
                                                    </div>
                                                </div>
                                            </div>
                                        </div>
                                    </li>
                                    <li data-id="4" id="menu-item-4">
                                        <div class="bb-menu-item">
                                            <div class="bb-menu-item-title">
                                                <i></i>
                                                <span>Privacy</span>

                                                <div class="bb-menu-actions pull-right">
                                                    <a href="javascript:" class="bb-menu-delete">
                                                        <i class="fa fa-close"></i>
                                                    </a>
                                                    <a href="javascript:" class="bb-menu-collapse">
                                                        <i class="fa fa-caret-down"></i>
                                                    </a>
                                                </div>
                                            </div>
                                            <div class="bb-menu-item-body">
                                                <div class="bb-menu-form">
                                                    <div class="row">
                                                        <div class="col-md-4">
                                                            <div class="form-group">
                                                                <label>Icon</label>
                                                                <input type="text" data-placement="right"
                                                                       class="form-control input-sm icp-auto">
                                                            </div>
                                                        </div>
                                                        <div class="col-md-8">
                                                            <div class="form-group">
                                                                <label>Item Title</label>
                                                                <input type="text"
                                                                       class="form-control input-sm menu-item-title">
                                                            </div>
                                                        </div>
                                                    </div>

                                                    <div class="form-group">
                                                        <label>Item URL</label>
                                                        <input type="text" class="form-control input-sm">
                                                    </div>
                                                </div>
                                            </div>
                                        </div>
                                    </li>
                                </ol>

                            </div>
                        </div>
                    </li>
                </ol>

                <textarea class="form-control" id="log" rows="15" placeholder="JSON LOG"></textarea>
            </div>
            <div class="col-md-8">
                <div class="panel panel-default">
                    <div class="panel-body">
                        <ol class="bb-menu-area"></ol>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

<script>
    $(function () {

        $('.bb-sortable-static li').draggable({
            helper: "clone",
            revert: "invalid",
            connectToSortable: '.bb-menu-area'
        });

        $('.bb-menu-area').nestedSortable({
            isTree: true,
            items: 'li',
            change: function () {
                iconSelector();
            },
            receive: function () {
                iconSelector();
            }
        });

        $('.bb-menu-save').click(function (){
            var menuJson = $('ol.bb-menu-area').nestedSortable('toHierarchy', {startDepthCount: 0});
            $("#log").text(JSON.stringify(menuJson));
        });

        function iconSelector() {
            $('.icp-auto').iconpicker();
            $('.icp-auto').on('iconpickerSelected', function (e) {
                var icon = e.iconpickerValue;
                $(this).closest('.bb-menu-item').find('.bb-menu-item-title>i').attr('class', 'fa ' + icon);
            });

            $('.bb-menu-item').each(function () {
                var $this = $(this),
                    title = $this.find('.bb-menu-item-title>span').text();

                $this.find('.menu-item-title').val(title);
            });
        }

        $('.bb-sortable-static .bb-menu-item-title').each(function (){
            var $this = $(this);

            $this.append(
                '<a href="javascript:" class="bb-add-to-menu pull-right">\n' +
                ' <i class="fa fa-plus"></i>\n' +
                '</a>'
            );
        });

        $('.bb-sortable-static:not(.bb-sortable-group)>li').each(function (){
            var $this = $(this);

            var title = $this.find('.bb-menu-item-title>span').text();
            $this.attr("data-title", title);
            $this.attr("data-icon", '');

            $this.find('.menu-item-title').val(title);
        });

        $('body')
            .on('input', '.menu-item-title', function () {
                var value = $(this).val();
                $(this).closest('.bb-menu-item').find('.bb-menu-item-title>span').text(value);
                $(this).closest('li').attr('data-title', value);
            })
            .on('click', '.bb-menu-collapse', function () {
                var $this = $(this);
                var body = $this.closest('.bb-menu-item').find('.bb-menu-item-body');
                var bodyGroup = $this.closest('li').find('.bb-menu-group-body');
                var icon = $this.find('i');

                if ($this.hasClass("expand")) {
                    body.slideUp();
                    bodyGroup.slideUp();
                    $this.removeClass("expand");
                    icon.addClass("fa-caret-down");
                    icon.removeClass('fa-caret-up');
                } else {
                    body.slideDown();
                    bodyGroup.slideDown();
                    $this.addClass("expand");
                    icon.removeClass("fa-caret-down");
                    icon.addClass('fa-caret-up');
                }
            })
            .on('click', '.bb-menu-delete', function () {
                var $this = $(this);
                var item = $this.closest('li');

                item.slideUp(function () {
                    $(this).remove();
                });
            })
            .on('click', '.bb-add-to-menu', function (){
                var $this = $(this);
                var item = $this.closest('li[data-id]').clone();
                $('.bb-menu-area').append(item);
            });
    });
</script>