<div class="bb-menu-container">
    <div class="container-fluid">
        <div class="row">
            <div class="col-md-12">
                <div class="panel panel-default">
                    <div class="panel-heading menu-panel">
                        <h3 class="panel-title pull-left">
                            <label>Menu Name</label>
                            <input type="text" class="menu-name-field" value="Main Menu">
                        </h3>

                        <div class="pull-right">
                            <a href="javascript:" class="btn btn-warning btn-sm bb-menu-settings">
                                <i class="fa fa-cog"></i>
                            </a>
                            <a href="javascript:" class="btn btn-primary btn-sm bb-menu-save">Save</a>
                            <a href="javascript:" class="btn btn-success btn-sm">Preview</a>
                        </div>
                    </div>

                    <div class="panel-body general-menu-settings">
                        <div class="bb-menu-form">
                            <div class="row">
                                <div class="col-md-5">
                                    <label class="text-primary">How menu display for different visitors types?</label>

                                    <p class="bg-warning bb-menu-settings-note">
                                        <small><strong>Color Guide: </strong></small>
                                        <small><i class="fa fa-circle text-success"></i> Display</small>
                                        <small><i class="fa fa-circle text-danger"></i> Hide</small>
                                    </p>

                                    <p>
                                        <a href="" class="btn btn-xs btn-danger bb-bulk-roles" data-bulk="hide">Hide for all</a>
                                        <a href="" class="btn btn-xs btn-success bb-bulk-roles" data-bulk="show">Show for all</a>
                                        <a href="" class="btn btn-xs btn-primary bb-bulk-roles" data-bulk="members">Show for members</a>
                                    </p>

                                    <div class="form-group has-feedback">
                                        <label>Filter roles</label>
                                        <input type="text" class="form-control" id="bb-role-filter" placeholder="Type search keyword">
                                        <span class="glyphicon glyphicon-search form-control-feedback"></span>
                                    </div>

                                    <ul class="list-group bb-roles-list">
                                        <li class="list-group-item" data-role="guests" data-title="Guests" data-display="show">
                                            <i class="fa fa-circle text-success"></i>

                                            <span class="btn-group">
                                                <button type="button" class="btn btn-default btn-xs dropdown-toggle" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
                                                    <span class="caret"></span>
                                                </button>
                                                <ul class="dropdown-menu">
                                                    <li><a href="javascript:" class="bb-role-hide-me">Hide me</a></li>
                                                    <li><a href="javascript:" class="bb-role-hide-others">Hide others</a></li>
                                                </ul>
                                            </span>

                                            <span class="bb-role-title">Guests</span>

                                            <a href="javascript:" class="pull-right text-info bb-what-to-show">
                                                <small>What to show instead?</small>
                                                <i class="fa fa-chevron-right"></i>
                                            </a>
                                        </li>
                                        <li class="list-group-item" data-role="normal-user" data-title="Normal User" data-display="show">
                                            <i class="fa fa-circle text-success"></i>

                                            <span class="btn-group">
                                                <button type="button" class="btn btn-default btn-xs dropdown-toggle" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
                                                    <span class="caret"></span>
                                                </button>
                                                <ul class="dropdown-menu">
                                                    <li><a href="javascript:" class="bb-role-hide-me">Hide me</a></li>
                                                    <li><a href="javascript:" class="bb-role-hide-others">Hide others</a></li>
                                                </ul>
                                            </span>

                                            <span class="bb-role-title">Normal User</span>

                                            <a href="javascript:" class="pull-right text-info bb-what-to-show">
                                                <small>What to show instead?</small>
                                                <i class="fa fa-chevron-right"></i>
                                            </a>
                                        </li>
                                        <li class="list-group-item" data-role="pro-user" data-title="Pro User" data-display="show">
                                            <i class="fa fa-circle text-success"></i>

                                            <span class="btn-group">
                                                <button type="button" class="btn btn-default btn-xs dropdown-toggle" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
                                                    <span class="caret"></span>
                                                </button>
                                                <ul class="dropdown-menu">
                                                    <li><a href="javascript:" class="bb-role-hide-me">Hide me</a></li>
                                                    <li><a href="javascript:" class="bb-role-hide-others">Hide others</a></li>
                                                </ul>
                                            </span>

                                            <span class="bb-role-title">Pro User</span>

                                            <a href="javascript:" class="pull-right text-info bb-what-to-show">
                                                <small>What to show instead?</small>
                                                <i class="fa fa-chevron-right"></i>
                                            </a>
                                        </li>
                                        <li class="list-group-item" data-role="editor" data-title="Editor" data-display="show">
                                            <i class="fa fa-circle text-success"></i>

                                            <span class="btn-group">
                                                <button type="button" class="btn btn-default btn-xs dropdown-toggle" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
                                                    <span class="caret"></span>
                                                </button>
                                                <ul class="dropdown-menu">
                                                    <li><a href="javascript:" class="bb-role-hide-me">Hide me</a></li>
                                                    <li><a href="javascript:" class="bb-role-hide-others">Hide others</a></li>
                                                </ul>
                                            </span>

                                            <span class="bb-role-title">Editor</span>

                                            <a href="javascript:" class="pull-right text-info bb-what-to-show">
                                                <small>What to show instead?</small>
                                                <i class="fa fa-chevron-right"></i>
                                            </a>
                                        </li>
                                        <li class="list-group-item" data-role="contributor" data-title="Contributor" data-display="show">
                                            <i class="fa fa-circle text-success"></i>

                                            <span class="btn-group">
                                                <button type="button" class="btn btn-default btn-xs dropdown-toggle" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
                                                    <span class="caret"></span>
                                                </button>
                                                <ul class="dropdown-menu">
                                                    <li><a href="javascript:" class="bb-role-hide-me">Hide me</a></li>
                                                    <li><a href="javascript:" class="bb-role-hide-others">Hide others</a></li>
                                                </ul>
                                            </span>

                                            <span class="bb-role-title">Contributor</span>

                                            <a href="javascript:" class="pull-right text-info bb-what-to-show">
                                                <small>What to show instead?</small>
                                                <i class="fa fa-chevron-right"></i>
                                            </a>
                                        </li>
                                    </ul>
                                </div>
                                <div class="col-md-4">
                                    <div class="what-to-show-panel hide" data-for="guests">
                                        <div class="form-group">
                                            <label>What to show for "Guests" role?</label>
                                            <select name="guests_show" class="form-control input-sm">
                                                <option value="hide">Hide Only</option>
                                                <option value="unit">Render Unit</option>
                                                <option value="menu">Render another menu</option>
                                            </select>
                                        </div>

                                        <div class="form-group hide" data-render="unit">
                                            <label>Select unit</label>
                                            <button class="btn btn-primary form-control">BB Button for units</button>
                                        </div>

                                        <div class="form-group hide" data-render="menu">
                                            <label>Select menu</label>
                                            <button class="btn btn-info form-control">BB Button for menus</button>
                                        </div>
                                    </div>
                                    <div class="what-to-show-panel hide" data-for="normal-user">
                                        <div class="form-group">
                                            <label>What to show for "Normal User" role?</label>
                                            <select name="normal-user_show" class="form-control input-sm">
                                                <option value="hide">Hide Only</option>
                                                <option value="unit">Render Unit</option>
                                                <option value="menu">Render another menu</option>
                                            </select>
                                        </div>

                                        <div class="form-group hide" data-render="unit">
                                            <label>Select unit</label>
                                            <button class="btn btn-primary form-control">BB Button for units</button>
                                        </div>

                                        <div class="form-group hide" data-render="menu">
                                            <label>Select menu</label>
                                            <button class="btn btn-info form-control">BB Button for menus</button>
                                        </div>
                                    </div>
                                    <div class="what-to-show-panel hide" data-for="pro-user">
                                        <div class="form-group">
                                            <label>What to show for "Pro User" role?</label>
                                            <select name="pro-user_show" class="form-control input-sm">
                                                <option value="hide">Hide Only</option>
                                                <option value="unit">Render Unit</option>
                                                <option value="menu">Render another menu</option>
                                            </select>
                                        </div>

                                        <div class="form-group hide" data-render="unit">
                                            <label>Select unit</label>
                                            <button class="btn btn-primary form-control">BB Button for units</button>
                                        </div>

                                        <div class="form-group hide" data-render="menu">
                                            <label>Select menu</label>
                                            <button class="btn btn-info form-control">BB Button for menus</button>
                                        </div>
                                    </div>
                                    <div class="what-to-show-panel hide" data-for="editor">
                                        <div class="form-group">
                                            <label>What to show for "Editor" role?</label>
                                            <select name="editor_show" class="form-control input-sm">
                                                <option value="hide">Hide Only</option>
                                                <option value="unit">Render Unit</option>
                                                <option value="menu">Render another menu</option>
                                            </select>
                                        </div>

                                        <div class="form-group hide" data-render="unit">
                                            <label>Select unit</label>
                                            <button class="btn btn-primary form-control">BB Button for units</button>
                                        </div>

                                        <div class="form-group hide" data-render="menu">
                                            <label>Select menu</label>
                                            <button class="btn btn-info form-control">BB Button for menus</button>
                                        </div>
                                    </div>
                                    <div class="what-to-show-panel hide" data-for="contributor">
                                        <div class="form-group">
                                            <label>What to show for "Contributor" role?</label>
                                            <select name="contributor_show" class="form-control input-sm">
                                                <option value="hide">Hide Only</option>
                                                <option value="unit">Render Unit</option>
                                                <option value="menu">Render another menu</option>
                                            </select>
                                        </div>

                                        <div class="form-group hide" data-render="unit">
                                            <label>Select unit</label>
                                            <button class="btn btn-primary form-control">BB Button for units</button>
                                        </div>

                                        <div class="form-group hide" data-render="menu">
                                            <label>Select menu</label>
                                            <button class="btn btn-info form-control">BB Button for menus</button>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <div class="row">
            <div class="col-md-4">
                <ol class="bb-sortable-static bb-sortable-group">
                    <li data-id="frontend-pages" id="menu-item-front" class="no-nest">
                        <div class="panel panel-default">
                            <div class="bb-menu-item-title">
                                <i></i>
                                <strong>Frontend Pages</strong>

                                <div class="bb-menu-actions pull-right">
                                    <a href="javascript:" class="bb-menu-delete">
                                        <i class="fa fa-close"></i>
                                    </a>
                                    <a href="javascript:" class="bb-menu-collapse expand group-expander">
                                        <i class="fa fa-caret-up"></i>
                                    </a>
                                </div>
                            </div>
                            <div class="panel-body bb-menu-group-body">

                                <ol class="bb-sortable-static">
                                    <li data-id="1" id="menu-item-1">
                                        <div class="bb-menu-item">
                                            <div class="bb-menu-item-title">
                                                <i></i>
                                                <span>Home</span>

                                                <div class="bb-menu-actions pull-right">
                                                    <a href="javascript:" class="bb-menu-delete">
                                                        <i class="fa fa-close"></i>
                                                    </a>
                                                    <a href="javascript:" class="bb-menu-collapse">
                                                        <i class="fa fa-caret-down"></i>
                                                    </a>
                                                </div>
                                            </div>
                                            <div class="bb-menu-item-body">
                                                <div class="bb-menu-form">
                                                    <div class="row">
                                                        <div class="col-md-4">
                                                            <div class="form-group">
                                                                <label>Icon</label>
                                                                <input type="text" data-placement="right"
                                                                       class="form-control input-sm icp-auto">
                                                            </div>
                                                        </div>
                                                        <div class="col-md-8">
                                                            <div class="form-group">
                                                                <label>Item Title</label>
                                                                <input type="text"
                                                                       class="form-control input-sm menu-item-title">
                                                            </div>
                                                        </div>
                                                    </div>

                                                    <div class="row">
                                                        <div class="col-md-6">
                                                            <div class="form-group">
                                                                <label>Item URL</label>
                                                                <input type="text" class="form-control input-sm">
                                                            </div>
                                                        </div>
                                                        <div class="col-md-6">
                                                            <div class="form-group">
                                                                <label>Display Roles</label>
                                                                <select name="display_roles" class="form-control input-sm">
                                                                    <option value="">All Visitors</option>
                                                                    <option value="">Members Only</option>
                                                                    <option value="">Guests Only</option>
                                                                    <option value="specific">Specific Roles</option>
                                                                </select>
                                                            </div>
                                                        </div>
                                                    </div>

                                                    <div class="form-group specific hide">
                                                        <label>Select Roles</label>
                                                        <select name="" multiple class="form-control input-sm">
                                                            <option value="">Normal User</option>
                                                            <option value="">Pro User</option>
                                                            <option value="">Editor</option>
                                                            <option value="">Contributor</option>
                                                        </select>
                                                    </div>
                                                </div>
                                            </div>
                                        </div>
                                    </li>
                                    <li data-id="2" id="menu-item-2" class="level-1">
                                        <div class="bb-menu-item">
                                            <div class="bb-menu-item-title">
                                                <i></i>
                                                <span>About</span>

                                                <div class="bb-menu-actions pull-right">
                                                    <a href="javascript:" class="bb-menu-delete">
                                                        <i class="fa fa-close"></i>
                                                    </a>
                                                    <a href="javascript:" class="bb-menu-collapse">
                                                        <i class="fa fa-caret-down"></i>
                                                    </a>
                                                </div>
                                            </div>
                                            <div class="bb-menu-item-body">
                                                <div class="bb-menu-form">
                                                    <div class="row">
                                                        <div class="col-md-4">
                                                            <div class="form-group">
                                                                <label>Icon</label>
                                                                <input type="text" data-placement="right"
                                                                       class="form-control input-sm icp-auto">
                                                            </div>
                                                        </div>
                                                        <div class="col-md-8">
                                                            <div class="form-group">
                                                                <label>Item Title</label>
                                                                <input type="text"
                                                                       class="form-control input-sm menu-item-title">
                                                            </div>
                                                        </div>
                                                    </div>

                                                    <div class="row">
                                                        <div class="col-md-6">
                                                            <div class="form-group">
                                                                <label>Item URL</label>
                                                                <input type="text" class="form-control input-sm">
                                                            </div>
                                                        </div>
                                                        <div class="col-md-6">
                                                            <div class="form-group">
                                                                <label>Display Roles</label>
                                                                <select name="display_roles" class="form-control input-sm">
                                                                    <option value="">All Visitors</option>
                                                                    <option value="">Members Only</option>
                                                                    <option value="">Guests Only</option>
                                                                    <option value="specific">Specific Roles</option>
                                                                </select>
                                                            </div>
                                                        </div>
                                                    </div>

                                                    <div class="form-group specific hide">
                                                        <label>Select Roles</label>
                                                        <select name="" multiple class="form-control input-sm">
                                                            <option value="">Normal User</option>
                                                            <option value="">Pro User</option>
                                                            <option value="">Editor</option>
                                                            <option value="">Contributor</option>
                                                        </select>
                                                    </div>
                                                </div>
                                            </div>
                                        </div>
                                    </li>
                                    <li data-id="3" id="menu-item-3" class="level-2">
                                        <div class="bb-menu-item">
                                            <div class="bb-menu-item-title">
                                                <i></i>
                                                <span>Contact</span>

                                                <div class="bb-menu-actions pull-right">
                                                    <a href="javascript:" class="bb-menu-delete">
                                                        <i class="fa fa-close"></i>
                                                    </a>
                                                    <a href="javascript:" class="bb-menu-collapse">
                                                        <i class="fa fa-caret-down"></i>
                                                    </a>
                                                </div>
                                            </div>
                                            <div class="bb-menu-item-body">
                                                <div class="bb-menu-form">
                                                    <div class="row">
                                                        <div class="col-md-4">
                                                            <div class="form-group">
                                                                <label>Icon</label>
                                                                <input type="text" data-placement="right"
                                                                       class="form-control input-sm icp-auto">
                                                            </div>
                                                        </div>
                                                        <div class="col-md-8">
                                                            <div class="form-group">
                                                                <label>Item Title</label>
                                                                <input type="text"
                                                                       class="form-control input-sm menu-item-title">
                                                            </div>
                                                        </div>
                                                    </div>

                                                    <div class="row">
                                                        <div class="col-md-6">
                                                            <div class="form-group">
                                                                <label>Item URL</label>
                                                                <input type="text" class="form-control input-sm">
                                                            </div>
                                                        </div>
                                                        <div class="col-md-6">
                                                            <div class="form-group">
                                                                <label>Display Roles</label>
                                                                <select name="display_roles" class="form-control input-sm">
                                                                    <option value="">All Visitors</option>
                                                                    <option value="">Members Only</option>
                                                                    <option value="">Guests Only</option>
                                                                    <option value="specific">Specific Roles</option>
                                                                </select>
                                                            </div>
                                                        </div>
                                                    </div>

                                                    <div class="form-group specific hide">
                                                        <label>Select Roles</label>
                                                        <select name="" multiple class="form-control input-sm">
                                                            <option value="">Normal User</option>
                                                            <option value="">Pro User</option>
                                                            <option value="">Editor</option>
                                                            <option value="">Contributor</option>
                                                        </select>
                                                    </div>
                                                </div>
                                            </div>
                                        </div>
                                    </li>
                                    <li data-id="4" id="menu-item-4" class="level-3">
                                        <div class="bb-menu-item">
                                            <div class="bb-menu-item-title">
                                                <i></i>
                                                <span>Privacy</span>

                                                <div class="bb-menu-actions pull-right">
                                                    <a href="javascript:" class="bb-menu-delete">
                                                        <i class="fa fa-close"></i>
                                                    </a>
                                                    <a href="javascript:" class="bb-menu-collapse">
                                                        <i class="fa fa-caret-down"></i>
                                                    </a>
                                                </div>
                                            </div>
                                            <div class="bb-menu-item-body">
                                                <div class="bb-menu-form">
                                                    <div class="row">
                                                        <div class="col-md-4">
                                                            <div class="form-group">
                                                                <label>Icon</label>
                                                                <input type="text" data-placement="right"
                                                                       class="form-control input-sm icp-auto">
                                                            </div>
                                                        </div>
                                                        <div class="col-md-8">
                                                            <div class="form-group">
                                                                <label>Item Title</label>
                                                                <input type="text"
                                                                       class="form-control input-sm menu-item-title">
                                                            </div>
                                                        </div>
                                                    </div>

                                                    <div class="row">
                                                        <div class="col-md-6">
                                                            <div class="form-group">
                                                                <label>Item URL</label>
                                                                <input type="text" class="form-control input-sm">
                                                            </div>
                                                        </div>
                                                        <div class="col-md-6">
                                                            <div class="form-group">
                                                                <label>Display Roles</label>
                                                                <select name="display_roles" class="form-control input-sm">
                                                                    <option value="">All Visitors</option>
                                                                    <option value="">Members Only</option>
                                                                    <option value="">Guests Only</option>
                                                                    <option value="specific">Specific Roles</option>
                                                                </select>
                                                            </div>
                                                        </div>
                                                    </div>

                                                    <div class="form-group specific hide">
                                                        <label>Select Roles</label>
                                                        <select name="" multiple class="form-control input-sm">
                                                            <option value="">Normal User</option>
                                                            <option value="">Pro User</option>
                                                            <option value="">Editor</option>
                                                            <option value="">Contributor</option>
                                                        </select>
                                                    </div>
                                                </div>
                                            </div>
                                        </div>
                                    </li>
                                    <li data-id="5" id="menu-item-5">
                                        <div class="bb-menu-item">
                                            <div class="bb-menu-item-title">
                                                <i></i>
                                                <span>Offers</span>

                                                <div class="bb-menu-actions pull-right">
                                                    <a href="javascript:" class="bb-menu-delete">
                                                        <i class="fa fa-close"></i>
                                                    </a>
                                                    <a href="javascript:" class="bb-menu-collapse">
                                                        <i class="fa fa-caret-down"></i>
                                                    </a>
                                                </div>
                                            </div>
                                            <div class="bb-menu-item-body">
                                                <div class="bb-menu-form">
                                                    <div class="row">
                                                        <div class="col-md-4">
                                                            <div class="form-group">
                                                                <label>Icon</label>
                                                                <input type="text" data-placement="right"
                                                                       class="form-control input-sm icp-auto">
                                                            </div>
                                                        </div>
                                                        <div class="col-md-8">
                                                            <div class="form-group">
                                                                <label>Item Title</label>
                                                                <input type="text"
                                                                       class="form-control input-sm menu-item-title">
                                                            </div>
                                                        </div>
                                                    </div>

                                                    <div class="row">
                                                        <div class="col-md-6">
                                                            <div class="form-group">
                                                                <label>Item URL</label>
                                                                <input type="text" class="form-control input-sm">
                                                            </div>
                                                        </div>
                                                        <div class="col-md-6">
                                                            <div class="form-group">
                                                                <label>Display Roles</label>
                                                                <select name="display_roles" class="form-control input-sm">
                                                                    <option value="">All Visitors</option>
                                                                    <option value="">Members Only</option>
                                                                    <option value="">Guests Only</option>
                                                                    <option value="specific">Specific Roles</option>
                                                                </select>
                                                            </div>
                                                        </div>
                                                    </div>

                                                    <div class="form-group specific hide">
                                                        <label>Select Roles</label>
                                                        <select name="" multiple class="form-control input-sm">
                                                            <option value="">Normal User</option>
                                                            <option value="">Pro User</option>
                                                            <option value="">Editor</option>
                                                            <option value="">Contributor</option>
                                                        </select>
                                                    </div>
                                                </div>
                                            </div>
                                        </div>
                                    </li>
                                    <li data-id="6" id="menu-item-6" class="level-1">
                                        <div class="bb-menu-item">
                                            <div class="bb-menu-item-title">
                                                <i></i>
                                                <span>Special Offers</span>

                                                <div class="bb-menu-actions pull-right">
                                                    <a href="javascript:" class="bb-menu-delete">
                                                        <i class="fa fa-close"></i>
                                                    </a>
                                                    <a href="javascript:" class="bb-menu-collapse">
                                                        <i class="fa fa-caret-down"></i>
                                                    </a>
                                                </div>
                                            </div>
                                            <div class="bb-menu-item-body">
                                                <div class="bb-menu-form">
                                                    <div class="row">
                                                        <div class="col-md-4">
                                                            <div class="form-group">
                                                                <label>Icon</label>
                                                                <input type="text" data-placement="right"
                                                                       class="form-control input-sm icp-auto">
                                                            </div>
                                                        </div>
                                                        <div class="col-md-8">
                                                            <div class="form-group">
                                                                <label>Item Title</label>
                                                                <input type="text"
                                                                       class="form-control input-sm menu-item-title">
                                                            </div>
                                                        </div>
                                                    </div>

                                                    <div class="row">
                                                        <div class="col-md-6">
                                                            <div class="form-group">
                                                                <label>Item URL</label>
                                                                <input type="text" class="form-control input-sm">
                                                            </div>
                                                        </div>
                                                        <div class="col-md-6">
                                                            <div class="form-group">
                                                                <label>Display Roles</label>
                                                                <select name="display_roles" class="form-control input-sm">
                                                                    <option value="">All Visitors</option>
                                                                    <option value="">Members Only</option>
                                                                    <option value="">Guests Only</option>
                                                                    <option value="specific">Specific Roles</option>
                                                                </select>
                                                            </div>
                                                        </div>
                                                    </div>

                                                    <div class="form-group specific hide">
                                                        <label>Select Roles</label>
                                                        <select name="" multiple class="form-control input-sm">
                                                            <option value="">Normal User</option>
                                                            <option value="">Pro User</option>
                                                            <option value="">Editor</option>
                                                            <option value="">Contributor</option>
                                                        </select>
                                                    </div>
                                                </div>
                                            </div>
                                        </div>
                                    </li>
                                </ol>

                            </div>
                        </div>
                    </li>
                </ol>

                <textarea class="form-control" id="log" rows="15" placeholder="JSON LOG"></textarea>
            </div>
            <div class="col-md-8">
                <div class="panel panel-default">
                    <div class="panel-body">
                        <ol class="bb-menu-area"></ol>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

<script type="template" id="option_template">
    <div class="form-group">
        <label>[name]</label>
        <select name="" class="form-control input-sm">
            <option value="">Hide Only</option>
            <option value="">Render Unit</option>
            <option value="">Render another menu</option>
        </select>
    </div>
</script>

<script>
    $(function () {

        $('.bb-sortable-static li').draggable({
            helper: "clone",
            revert: "invalid",
            connectToSortable: '.bb-menu-area'
        });

        $('.bb-menu-area').nestedSortable({
//            isTree: true,
//            items: 'li',
            change: function () {
                iconSelector();
            },
            receive: function () {
                iconSelector();
            },
            stop: function(event, ui) {
                if ($(ui.item).closest('ol').parent('li').hasClass("no-nest")) {
                    $("ol.bb-menu-area").sortable("cancel");
                }
            }
        });

        $('.bb-menu-save').click(function (){
            var menuJson = $('ol.bb-menu-area').nestedSortable('toHierarchy', {startDepthCount: 0});
            $("#log").text(JSON.stringify(menuJson));
        });

        $('.bb-menu-settings').click(function (){
            var $this = $(this);
            var body = $this.closest('.panel').find('.panel-body');

            if ($this.hasClass("expand")) {
                body.slideUp();
                $this.removeClass("expand");
            } else {
                body.slideDown();
                $this.addClass("expand");
            }
        });

        function iconSelector() {
            $('.icp-auto').iconpicker();
            $('.icp-auto').on('iconpickerSelected', function (e) {
                var icon = e.iconpickerValue;
                $(this).closest('.bb-menu-item').find('.bb-menu-item-title>i').attr('class', 'fa ' + icon);
            });

            $('.bb-menu-item').each(function () {
                var $this = $(this),
                    title = $this.find('.bb-menu-item-title>span').text();

                $this.find('.menu-item-title').val(title);
            });
        }

        $('.bb-sortable-static .bb-menu-item-title').each(function (){
            var $this = $(this);

            $this.append(
                '<a href="javascript:" class="bb-add-to-menu pull-right">\n' +
                ' <i class="fa fa-plus"></i>\n' +
                '</a>'
            );
        });

        $('.bb-sortable-static:not(.bb-sortable-group)>li').each(function (){
            var $this = $(this);

            var title = $this.find('.bb-menu-item-title>span').text();
            $this.attr("data-title", title);
            $this.attr("data-icon", '');

            $this.find('.menu-item-title').val(title);
        });

        $('body')
            .on('input', '.menu-item-title', function () {
                var value = $(this).val();
                $(this).closest('.bb-menu-item').find('.bb-menu-item-title>span').text(value);
                $(this).closest('li').attr('data-title', value);
            })
            .on('click', '.bb-menu-collapse', function () {
                var $this = $(this);
                var body = $this.closest('.bb-menu-item').find('.bb-menu-item-body');
                var bodyGroup = $this.closest('li').find('.bb-menu-group-body');
                var icon = $this.find('i');

                if ($this.hasClass("expand")) {
                    body.slideUp();
                    bodyGroup.slideUp();
                    $this.removeClass("expand");
                    icon.addClass("fa-caret-down");
                    icon.removeClass('fa-caret-up');
                } else {
                    body.slideDown();
                    bodyGroup.slideDown();
                    $this.addClass("expand");
                    icon.removeClass("fa-caret-down");
                    icon.addClass('fa-caret-up');
                }
            })
            .on('click', '.bb-menu-delete', function () {
                var $this = $(this);
                var item = $this.closest('li');

                item.slideUp(function () {
                    $(this).remove();
                });
            })
            .on('click', '.bb-add-to-menu', function (){
                var $this = $(this);
                var item = $this.closest('li[data-id]').clone();
                $('.bb-menu-area').append(item);
            })
            .on('change', '[name=display_roles]', function (){
                var specific = $(this).closest('.bb-menu-form').find('.specific');
                var others = $(this).closest('.bb-menu-form').find('.bb-other-visitors-panel');
                var value = $(this).val();

                if(value === 'specific'){
                    specific.removeClass('hide');
                    others.removeClass('hide');
                    $('[name=selected_roles]').trigger('click');
                }else{
                    others.addClass('hide');

                    if(value !== "all"){
                        others.removeClass('hide');
                    }

                    specific.addClass('hide');
                }
            })
            .on('click', '[name=selected_roles]', function (){
                var $this = $(this);
                var notSelected = $this.find('option:not(:selected)');
                var rolesOptions = $('.bb-menu-roles-options');
                var optionsHTML = "";

                rolesOptions.html('');

                $(notSelected).each(function (i, name){
                    var template = $('#option_template').html();
                    template = template.replace('[name]', $(this).val());
                    optionsHTML += template;
                });

                rolesOptions.html(optionsHTML);
            })
            // Role list and functions
            .on('click', '.bb-roles-list>.list-group-item .bb-role-hide-others', function (){
                var $this = $(this),
                    $element = $this.closest(".list-group-item");

                $('.bb-roles-list>.list-group-item').each(function (){
                    $(this)
                        .attr("data-display", "hide")
                        .find("i.fa-circle").removeClass("text-success").addClass("text-danger");
                });

                $element
                    .attr("data-display", "show")
                    .find("i.fa-circle").addClass("text-success").removeClass("text-danger");
            })
            .on('click', '.bb-roles-list>.list-group-item .bb-role-hide-me', function (){
                var $this = $(this),
                    $element = $this.closest(".list-group-item");


                if(!$this.attr("data-hidden") || $this.attr("data-hidden") === "false"){
                    $this.text("Show me").attr("data-hidden", true);
                    $element
                        .attr("data-display", "hide")
                        .find("i.fa-circle").removeClass("text-success").addClass("text-danger");
                }else{
                    $this.text("Hide me").attr("data-hidden", false);
                    $element
                        .attr("data-display", "show")
                        .find("i.fa-circle").addClass("text-success").removeClass("text-danger");
                }

            })
            .on('click', '.bb-roles-list>.list-group-item .bb-what-to-show', function (){
                var role = $(this).closest(".list-group-item").data("role");

                $('.what-to-show-panel').addClass("hide");
                $('.what-to-show-panel[data-for='+role+']').removeClass("hide");
            })
            .on('change', '.what-to-show-panel select', function (){
                var value = $(this).val();
                var $panel = $(this).closest(".what-to-show-panel");

                $panel.find('[data-render]').addClass("hide");
                $panel.find('[data-render='+value+']').removeClass("hide");
            })
            .on('input', '#bb-role-filter', function (){
                var $this = $(this),
                    filter = $this.val().toUpperCase();

                $('.bb-roles-list>.list-group-item').each(function (){
                    if($(this).attr("data-title").toUpperCase().indexOf(filter) > -1){
                        $(this).removeClass("hide");
                    }else{
                        $(this).addClass("hide");
                    }
                });
            })
            .on('click', '.bb-bulk-roles', function (){
                var action = $(this).data("bulk"),
                    removeClass, addClass, display;

                if(action === "hide"){
                    removeClass = "text-success";
                    addClass = "text-danger";
                    display = "hide";
                }
                else if(action === "show" || action === "members"){
                    removeClass = "text-danger";
                    addClass = "text-success";
                    display = "show";
                }

                $('.bb-roles-list>.list-group-item').each(function (){
                    $(this)
                        .attr("data-display", display)
                        .find("i.fa-circle").removeClass(removeClass).addClass(addClass);
                });

                if(action === "members"){
                    $('.bb-roles-list>.list-group-item[data-role=guests]')
                        .attr("data-display", "hide")
                        .find("i.fa-circle").removeClass("text-success").addClass("text-danger");
                }

            });
    });
</script>